> from django.test import TestCase
> from django.contrib.auth.models import Group
> from rest_framework.test import APIClient
  
> from apps.accounts.models import User
> from apps.products.models import Brand, Category, Product, ProductVariant
  
  
> class AdminSkuAutoGenerationTests(TestCase):
>     def setUp(self):
>         self.client = APIClient()
>         self.admin = User.objects.create_superuser(
>             username='admin',
>             email='admin@example.com',
>             password='password123',
>         )
>         self.client.force_authenticate(user=self.admin)
  
>         self.category = Category.objects.create(name='Test Category', slug='test-category')
>         self.brand = Brand.objects.create(name='Test Brand', slug='test-brand')
  
>     def test_admin_product_create_generates_sku_when_missing(self):
>         payload = {
>             'name': 'Test Product',
>             'description': 'Desc',
>             'short_description': '',
>             'category': self.category.id,
>             'brand': self.brand.id,
>             'sku': '',
>             'slug': '',
>             'price': '10.00',
>             'compare_price': None,
>             'cost_price': None,
>             'stock': 0,
>             'low_stock_threshold': 5,
>             'weight': None,
>             'is_active': True,
>             'is_featured': False,
>             'views_count': 0,
>         }
  
>         res = self.client.post('/api/v1/admin/products/products/', payload, format='json')
>         self.assertEqual(res.status_code, 201, res.data)
  
>         product = Product.objects.get(id=res.data['id'])
>         self.assertTrue(product.sku)
>         self.assertNotEqual(product.sku.strip(), '')
>         self.assertTrue(product.slug)
>         self.assertNotEqual(product.slug.strip(), '')
  
>     def test_admin_variant_create_generates_sku_when_blank(self):
>         product = Product.objects.create(
>             name='P1',
>             slug='p1',
>             description='d',
>             category=self.category,
>             brand=self.brand,
>             sku='P1-TESTSKU',
>             price='1.00',
>         )
  
>         payload = {
>             'product': product.id,
>             'name': 'Size',
>             'value': 'Large',
>             'sku': '',
>             'price_adjustment': '0.00',
>             'stock': 0,
>             'is_active': True,
>         }
  
>         res = self.client.post('/api/v1/admin/products/productvariants/', payload, format='json')
>         self.assertEqual(res.status_code, 201, res.data)
  
>         variant = ProductVariant.objects.get(id=res.data['id'])
>         self.assertTrue(variant.sku)
>         self.assertNotEqual(variant.sku.strip(), '')
  
  
> class AdminDocsEndpointTests(TestCase):
>     def setUp(self):
>         self.client = APIClient()
>         self.admin = User.objects.create_superuser(
>             username='admin_docs',
>             email='admin_docs@example.com',
>             password='password123',
>         )
>         self.user = User.objects.create_user(
>             username='user_docs',
>             email='user_docs@example.com',
>             password='password123',
>         )
  
>     def test_docs_list_requires_admin(self):
>         self.client.force_authenticate(user=self.user)
>         res = self.client.get('/docs/')
>         self.assertEqual(res.status_code, 403)
  
>     def test_docs_list_returns_docs_for_admin(self):
>         self.client.force_authenticate(user=self.admin)
>         res = self.client.get('/docs/')
>         self.assertEqual(res.status_code, 200, res.data)
>         self.assertIn('docs', res.data)
>         self.assertIsInstance(res.data['docs'], list)
  
          # Repo ships at least API.md / DATABASE.md under backend/docs
>         if res.data['docs']:
>             self.assertIn('name', res.data['docs'][0])
>             self.assertIn('title', res.data['docs'][0])
  
>     def test_docs_detail_requires_admin(self):
>         self.client.force_authenticate(user=self.user)
>         res = self.client.get('/docs/API.md/')
>         self.assertEqual(res.status_code, 403)
  
>     def test_docs_detail_returns_markdown_content_for_admin(self):
>         self.client.force_authenticate(user=self.admin)
  
>         list_res = self.client.get('/docs/')
>         self.assertEqual(list_res.status_code, 200, list_res.data)
>         docs = list_res.data.get('docs', [])
>         self.assertTrue(len(docs) > 0, 'Expected at least one doc in backend/docs')
  
>         name = docs[0]['name']
>         res = self.client.get(f'/docs/{name}/')
>         self.assertEqual(res.status_code, 200, res.data)
>         self.assertEqual(res.data.get('name'), name)
>         self.assertEqual(res.data.get('content_type'), 'text/markdown')
>         self.assertTrue(isinstance(res.data.get('content'), str))
>         self.assertTrue(len(res.data.get('content')) > 0)
  
>     def test_docs_detail_blocks_path_traversal(self):
>         self.client.force_authenticate(user=self.admin)
>         res = self.client.get('/docs/../settings.py/')
>         self.assertEqual(res.status_code, 404)
  
>     def test_docs_list_allows_group_member(self):
>         group = Group.objects.create(name='admin_portal')
>         self.user.groups.add(group)
>         self.client.force_authenticate(user=self.user)
  
>         res = self.client.get('/docs/')
>         self.assertEqual(res.status_code, 200, res.data)
  
>     def test_docs_detail_allows_group_member(self):
>         group = Group.objects.create(name='admin_portal')
>         self.user.groups.add(group)
>         self.client.force_authenticate(user=self.user)
  
>         list_res = self.client.get('/docs/')
>         self.assertEqual(list_res.status_code, 200, list_res.data)
>         docs = list_res.data.get('docs', [])
>         self.assertTrue(len(docs) > 0, 'Expected at least one doc in backend/docs')
  
>         name = docs[0]['name']
>         res = self.client.get(f'/docs/{name}/')
>         self.assertEqual(res.status_code, 200, res.data)
